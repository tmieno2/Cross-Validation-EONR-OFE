```{r }
library(spatialreg)
data(oldcol)
lw <- nb2listw(COL.nb, style = "W")
```


# This works

```{r }
ser_res <- spatialreg::errorsarlm(CRIME ~ INC + HOVAL,
  data = COL.OLD, lw, method = "eigen"
)

predict(ser_res, newdata = COL.OLD)
```


# This does not work

```{r }
ser_res <- spatialreg::errorsarlm("CRIME ~ INC + HOVAL",
  data = COL.OLD, lw, method = "eigen"
)

predict(ser_res, newdata = COL.OLD)
```


# formula defined inside a function (does NOT work)

```{r }
get_y_hat <- function() {
  reg_formula <- "CRIME ~ INC + HOVAL" %>% formula()

  ser_res <- spatialreg::errorsarlm(reg_formula,
    data = COL.OLD, lw, method = "eigen"
  )

  y_hat <- predict(ser_res, newdata = COL.OLD)

  return(y_hat)
}

get_y_hat()
```

# formula defined outside the function first (does work)

```{r }
reg_formula <- "CRIME ~ INC + HOVAL" %>% formula()

get_y_hat()
```
 